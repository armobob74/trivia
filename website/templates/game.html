<p>{{ question['text'] }}</p>

<script src="/static/javascript/cookieFunctions.js"></script>
<form action="/submit-answer" method="POST">
	<input type="hidden" name="username" id="username" value=""/>
	<input type="hidden" name="game_id" id="game_id" value="{{game_id}}"/>
	<input type="hidden" name="question_id" id="question_id" value="{{question['id']}}"/>
	<input type="radio" name="answer" id="A" value="A">{{question['A']}}</input>
	<input type="radio" name="answer" id="B" value="B">{{question['B']}}</input>
	<input type="radio" name="answer" id="C" value="C">{{question['C']}}</input>
	<input type="radio" name="answer" id="D" value="D">{{question['D']}}</input>
	<button type="submit" onclick=updateManager()>Submit</button>
</form>

<script src="/static/javascript/userCookie.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.js"></script>
<script>
    var socket = io.connect('/');
    
    socket.on('connect', function() {
        console.log('Connected to server');
    });
    
    socket.on('join_room_response', function(msg) {
        console.log("Recieved join_room_response:",msg);
    });

    socket.on('refresh_order', function(msg) {
	location.reload();
        console.log("Recieved refresh order:",msg);
    });

    socket.emit('join', {'username': username , 'room': {{game_id}}});

    // if user has already submitted answer, disable form and wait for next question.

    socket.emit('check_answer_submitted',{'username':username,'game_id':{{game_id}},'question_id':{{question['id']}}})

    function updateManager(){
	    msg = {
		    'username':username,
		    'game_id':{{game_id}},
		    'username':{{question['id']}}
	    }
	    socket.emit('update_manager',msg)
    }

    // disable the form so that user may no longer submit questions 
    {# TODO: gotta add something to the backend to make this more secure eventually #}
    socket.on('check_answer_submitted_response', function(msg) {
	console.log('Recieved check_answer_submitted_response:',msg)
	if(msg['bool']==true){
		f = document.getElementsByTagName('form')[0]
		for(inpt of f.getElementsByTagName('input')){
			inpt.disabled=true;
		}
		selected_answer = document.getElementById(msg['answer'])
		selected_answer.checked=true;
		btn = f.getElementsByTagName('button')[0]
		btn.outerHTML = '<p>submitted</p>'
	}else{
		for(inpt of document.getElementsByTagName('input')){
			inpt.checked=false;
		}

	}
    });


</script>
