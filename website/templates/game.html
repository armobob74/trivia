<p>{{ question['text'] }}</p>

<form action="/submit-answer" method="POST">
	<input type="radio" name="answer" id="A" value="A">{{question['A']}}</input>
	<input type="radio" name="answer" id="B" value="B">{{question['B']}}</input>
	<input type="radio" name="answer" id="C" value="C">{{question['C']}}</input>
	<input type="radio" name="answer" id="D" value="D">{{question['D']}}</input>
	<button type="button" onclick="submitAnswer();updateManager();" >Submit</button>
</form>


<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.3/socket.io.js"></script>
<script>
	var game_id = {{game_id}}
	var socket = io.connect('/'); //needs to come before cookieFunctions
</script>
<script src="/static/javascript/cookieFunctions.js"></script>
<script src="/static/javascript/userCookie.js"></script>
<script>
    let question_form = document.getElementsByTagName('form')[0]
    
    socket.on('connect', function() {
        console.log('Connected to server');
    });
    
    socket.on('join_room_response', function(msg) {
        console.log("Recieved join_room_response:",msg);
    });

    socket.on('refresh_order', function(msg) {
	location.reload();
        console.log("Recieved refresh order:",msg);
    });

    socket.emit('join', {'username': username , 'room': game_id});

    // if user has already submitted answer, disable form and wait for next question.

    socket.emit('check_answer_submitted',{'username':username,'game_id':game_id,'question_id':{{question['id']}}})

    function updateManager(){
	    inputs = question_form.getElementsByTagName('input')
	    for(input of inputs){
		if(input.name == 'answer' && input.checked){
			answer_letter = input.value
		}
	    }
	    msg = {
		    'username':username,
		    'game_id':{{game_id}},
		    'question_id':{{question['id']}},
		    'answer_letter':answer_letter	
	    }
	    socket.emit('update_manager_request',msg)
	    console.log('Sent update_manager_request',msg)
    }

    function submitAnswer(){
	    inputs = question_form.getElementsByTagName('input')
	    for(input of inputs){
		if(input.name == 'answer' && input.checked){
			answer_letter = input.value
		}
	    }
	    msg = {
		    'username':username,
		    'game_id':{{game_id}},
		    'question_id':{{question['id']}},
		    'answer_letter':answer_letter	
	    }
	socket.emit('submit_answer_request',msg)
	console.log('Sent submit_answer_request')
	disableForm()
    }

    function disableForm(){
		for(inpt of question_form.getElementsByTagName('input')){
			inpt.disabled=true;
		}
		btn = question_form.getElementsByTagName('button')[0]
		btn.outerHTML = '<p>submitted</p>'
    }

    // check on refresh to see if form should be enabled or disabled
    {# TODO: gotta add something to the backend to make this more secure eventually #}
    socket.on('check_answer_submitted_response', function(msg) {
	console.log('Recieved check_answer_submitted_response:',msg)
	if(msg['bool']==true){
		disableForm()
		selected_answer = document.getElementById(msg['answer'])
		selected_answer.checked=true;
	}else{
		for(inpt of document.getElementsByTagName('input')){
			inpt.checked=false;
		}

	}
    });


</script>
